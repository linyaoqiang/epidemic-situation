/*!
* FilePondPluginImagePreview 4.0.4
* Licensed under MIT, https://opensource.org/licenses/MIT/
* Please visit https://pqina.nl/filepond for details.
*/

/* eslint-disable */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FilePondPluginImagePreview=t()}(this,function(){"use strict";var e={type:"spring",stiffness:.5,damping:.45,mass:10},t=function(e,t){return{x:e,y:t}},i=function(e,i){return t(e.x-i.x,e.y-i.y)},r=function(e,t){return Math.sqrt(function(e,t){return function(e,t){return e.x*t.x+e.y*t.y}(i(e,t),i(e,t))}(e,t))},a=function(e,i){var r=e,a=i,n=1.5707963267948966-i,o=Math.sin(1.5707963267948966),c=Math.sin(a),s=Math.sin(n),l=Math.cos(n),h=r/o;return t(l*(h*c),l*(h*s))},n=function(e,i,n,o){var c=o.x>.5?1-o.x:o.x,s=o.y>.5?1-o.y:o.y,l=2*c*e.width,h=2*s*e.height,f=function(e,i){var n=e.width,o=e.height,c=a(n,i),s=a(o,i),l=t(e.x+Math.abs(c.x),e.y-Math.abs(c.y)),h=t(e.x+e.width+Math.abs(s.y),e.y+Math.abs(s.x)),f=t(e.x-Math.abs(s.y),e.y+e.height-Math.abs(s.x));return{width:r(l,h),height:r(l,f)}}(i,n);return Math.max(f.width/l,f.height/h)},o=function(e){return e.utils.createView({name:"image-bitmap",tag:"canvas",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function(e){var t,i,r=e.root,a=e.props;t=a.image,(i=(i=r.element)||document.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)}})},c=function(t){return t.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(i){var r=i.root,a=i.props;r.ref.image=r.appendChildView(r.createChildView(function(t){return t.utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:e,originY:e,scaleX:e,scaleY:e,translateX:e,translateY:e,rotateZ:e}},create:function(e){var i=e.root,r=e.props;r.width=r.image.width,r.height=r.image.height,i.ref.image=i.appendChildView(i.createChildView(o(t),{image:r.image}))},write:function(e){var t=e.root,i=e.props.crop.flip,r=t.ref.image;r.scaleX=i.horizontal?-1:1,r.scaleY=i.vertical?-1:1}})}(t),Object.assign({},a)));var n=r.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==n&&(r.element.dataset.transparencyIndicator="grid"===n?n:"color")},write:function(e){var t=e.root,i=e.props,r=e.shouldOptimize,a=i.crop,o=i.width,c=i.height;t.ref.image.crop=a;var s={x:0,y:0,width:o,height:c,center:{x:.5*o,y:.5*c}},l={width:t.ref.image.width,height:t.ref.image.height},h={x:a.center.x*l.width,y:a.center.y*l.height},f={x:s.center.x-l.width*a.center.x,y:s.center.y-l.height*a.center.y},u=2*Math.PI+a.rotation%(2*Math.PI),p=a.aspectRatio||l.height/l.width,d=n(l,function(e,t){var i=e.width,r=i*t;return r>e.height&&(i=(r=e.height)/t),{x:.5*(e.width-i),y:.5*(e.height-r),width:i,height:r}}(s,p),u,a.center),E=a.zoom*d,g=t.ref.image;if(r)return g.originX=null,g.originY=null,g.translateX=null,g.translateY=null,g.rotateZ=null,g.scaleX=null,void(g.scaleY=null);g.originX=h.x,g.originY=h.y,g.translateX=f.x,g.translateY=f.y,g.rotateZ=u,g.scaleX=E,g.scaleY=E}})},s='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>',l=!1,h=0,f=function(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then(function(t){self.postMessage({id:e.data.id,message:t},[t])})}},u={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},p=function(e,t,i,r){t=Math.round(t),i=Math.round(i);var a=document.createElement("canvas");a.width=t,a.height=i;var n=a.getContext("2d");if(r>=5&&r<=8){var o=[i,t];t=o[0],i=o[1]}return function(e,t,i,r){-1!==r&&e.transform.apply(e,u[r](t,i))}(n,t,i,r),n.drawImage(e,0,0,t,i),a},d=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},E=function(e){var t=Math.min(10/e.width,10/e.height),i=document.createElement("canvas"),r=i.getContext("2d"),a=i.width=Math.ceil(e.width*t),n=i.height=Math.ceil(e.height*t);r.drawImage(e,0,0,a,n);var o=null;try{o=r.getImageData(0,0,a,n).data}catch(e){return null}for(var c=o.length,s=0,l=0,h=0,f=0;f<c;f+=4)s+=o[f]*o[f],l+=o[f+1]*o[f+1],h+=o[f+2]*o[f+2];return{r:s=g(s,c),g:l=g(l,c),b:h=g(h,c)}},g=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},_=function(t){var i=t.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,i=e.props;!l&&document.querySelector("base")&&(s=s.replace(/url\(\#/g,"url("+window.location.href.replace(window.location.hash,"")+"#"),l=!0),h++,t.element.classList.add("filepond--image-preview-overlay-".concat(i.status)),t.element.innerHTML=s.replace(/__UID__/g,h)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),r=function(t){return t.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["crop"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,translateY:e,opacity:{type:"tween",duration:400}}},create:function(e){var i=e.root,r=e.props;i.ref.clip=i.appendChildView(i.createChildView(c(t),{image:r.image,crop:r.crop}))},write:function(e){var t=e.root,i=e.props,r=e.shouldOptimize,a=t.ref.clip,n=i.crop,o=i.image;if(a.crop=n,a.opacity=r?0:1,!r){var c=o.height/o.width,s=n.aspectRatio||c,l=t.rect.inner.width,h=t.rect.inner.height,f=t.query("GET_IMAGE_PREVIEW_HEIGHT"),u=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),p=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),d=t.query("GET_PANEL_ASPECT_RATIO"),E=t.query("GET_ALLOW_MULTIPLE");d&&!E&&(f=l*d,s=d);var g=null!==f?f:Math.max(u,Math.min(l*s,p)),_=g/s;_>l&&(g=(_=l)*s),g>h&&(g=h,_=h/s),a.width=_,a.height=g}}})}(t),a=function(e){var t=e.root,i=e.props,a=i.id,n=t.query("GET_ITEM",{id:a});if(n){var o=i.preview,c=n.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},s=t.appendChildView(t.createChildView(r,{image:o,crop:c,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),t.childViews.length);t.ref.images.push(s),s.opacity=1,s.scaleX=1,s.scaleY=1,s.translateY=0,setTimeout(function(){t.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:a})},250)}},n=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},o=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return t.utils.createView({name:"image-preview-wrapper",create:function(e){var t=e.root;t.ref.images=[],t.ref.imageViewBin=[],t.ref.overlayShadow=t.appendChildView(t.createChildView(i,{opacity:0,status:"idle"})),t.ref.overlaySuccess=t.appendChildView(t.createChildView(i,{opacity:0,status:"success"})),t.ref.overlayError=t.appendChildView(t.createChildView(i,{opacity:0,status:"failure"}))},styles:["height"],apis:["height"],write:t.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:function(e){var t=e.root,i=t.ref.images[t.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:function(e){var i=e.root,r=e.props,a=(t.utils.createWorker,r.id),n=i.query("GET_ITEM",a);if(n){var o,c,s,l=URL.createObjectURL(n.file);o=l,c=function(e,t){i.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:a,width:e,height:t})},(s=new Image).onload=function(){var e=s.naturalWidth,t=s.naturalHeight;s=null,c(e,t)},s.src=o}},DID_FINISH_CALCULATE_PREVIEWSIZE:function(e){var i=e.root,r=e.props,n=t.utils.createWorker,o=r.id,c=i.query("GET_ITEM",o);if(c){var s,l=URL.createObjectURL(c.file),h=function(){var e;(e=l,new Promise(function(t,i){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){t(r)},r.onerror=function(e){i(e)},r.src=e})).then(u)},u=function(e){URL.revokeObjectURL(l);var t=(c.getMetadata("exif")||{}).orientation||-1,n=e.width,o=e.height;if(t>=5&&t<=8){var s=[o,n];n=s[0],o=s[1]}var h=window.devicePixelRatio,f=o/n,u=i.rect.element.width,d=i.rect.element.height,g=0,_=0;_=(g=u)*f,f>1?_=(g=u)*f:g=(_=d)/f,r.preview=p(e,Math.min(n,g*h*4),Math.min(o,_*h*4),t);var I=i.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?E(e):null;c.setMetadata("color",I,!0),"close"in e&&e.close(),i.ref.overlayShadow.opacity=1,a({root:i,props:r})};if(s=c.file,"createImageBitmap"in window&&d(s)){var g=n(f);g.post({file:c.file},function(e){g.terminate(),e?u(e):h()})}else h()}},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;if("crop"===e.action.change.key&&t.ref.images.length){var r=t.query("GET_ITEM",{id:i.id});if(r){var n=r.getMetadata("crop"),o=t.ref.images[t.ref.images.length-1];Math.abs(n.aspectRatio-o.crop.aspectRatio)>1e-5?(function(e){var t=e.root,i=t.ref.images.shift();i.opacity=0,i.translateY=-15,t.ref.imageViewBin.push(i)}({root:t}),a({root:t,props:i})):function(e){var t=e.root,i=e.props,r=t.query("GET_ITEM",{id:i.id});r&&(t.ref.images[t.ref.images.length-1].crop=r.getMetadata("crop"))}({root:t,props:i})}}},DID_THROW_ITEM_LOAD_ERROR:o,DID_THROW_ITEM_PROCESSING_ERROR:o,DID_THROW_ITEM_INVALID:o,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:n,DID_REVERT_ITEM_PROCESSING:n},function(e){var t=e.root,i=t.ref.imageViewBin.filter(function(e){return 0===e.opacity});t.ref.imageViewBin=t.ref.imageViewBin.filter(function(e){return e.opacity>0}),i.forEach(function(e){return function(e,t){e.removeChildView(t),t._destroy()}(t,e)}),i.length=0})})},I=function(e){var t=e.addFilter,i=e.utils,r=i.Type,a=i.createRoute,n=i.isFile,o=_(e);return t("CREATE_VIEW",function(e){var t=e.is,i=e.view,r=e.query;if(t("file")&&r("GET_ALLOW_IMAGE_PREVIEW")){var c=function(e,t){if(e.ref.imagePreview){var i=t.id,r=e.query("GET_ITEM",{id:i});if(r){var a=e.query("GET_PANEL_ASPECT_RATIO"),n=e.query("GET_ITEM_PANEL_ASPECT_RATIO"),o=e.query("GET_IMAGE_PREVIEW_HEIGHT");if(!(a||n||o)){var c=e.ref,s=c.imageWidth,l=c.imageHeight;if(s&&l){var h=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),f=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),u=(r.getMetadata("exif")||{}).orientation||-1;if(u>=5&&u<=8){var p=[l,s];s=p[0],l=p[1]}if(!d(r.file)){var E=2048/s;s*=E,l*=E}var g=l/s,_=(r.getMetadata("crop")||{}).aspectRatio||g,I=Math.max(h,Math.min(l,f)),m=e.rect.element.width,v=Math.min(m*_,I);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:r.id,height:v})}}}}},s=function(e){var t=e.root,i=e.props;c(t,i)};i.registerWriter(a({DID_RESIZE_ROOT:s,DID_STOP_RESIZE:s,DID_LOAD_ITEM:function(e){var t=e.root,a=e.props,c=(e.actions,a.id),s=r("GET_ITEM",c);if(s&&n(s.file)&&!s.archived){var l=s.file;if(function(e){return/^image/.test(e.type)}(l)){var h="createImageBitmap"in(window||{}),f=r("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!(!h&&f&&l.size>f)){t.ref.imagePreview=i.appendChildView(i.createChildView(o,{id:c}));var u=t.query("GET_IMAGE_PREVIEW_HEIGHT");u&&t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s.id,height:u});var p=!h&&l.size>r("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");t.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:c},p)}}}},DID_IMAGE_PREVIEW_CALCULATE_SIZE:function(e){var t=e.root,i=e.props,r=e.action;t.ref.imageWidth=r.width,t.ref.imageHeight=r.height,c(t,i),requestAnimationFrame(function(){t.dispatch("DID_FINISH_CALCULATE_PREVIEWSIZE")})},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;"crop"===e.action.change.key&&c(t,i)}}))}}),{options:{allowImagePreview:[!0,r.BOOLEAN],imagePreviewHeight:[null,r.INT],imagePreviewMinHeight:[44,r.INT],imagePreviewMaxHeight:[256,r.INT],imagePreviewMaxFileSize:[null,r.INT],imagePreviewMaxInstantPreviewFileSize:[1e6,r.INT],imagePreviewTransparencyIndicator:[null,r.STRING],imagePreviewCalculateAverageImageColor:[!1,r.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:I})),I});
